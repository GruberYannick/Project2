var FieldState;
(function (FieldState) {
    FieldState[FieldState["Unset"] = 0] = "Unset";
    FieldState[FieldState["Alive"] = 1] = "Alive";
    FieldState[FieldState["Dead"] = 2] = "Dead";
})(FieldState || (FieldState = {}));
class GameField extends HTMLElement {
    constructor() {
        super();
        this.columns = 60;
        this.rows = 25;
        this.size = 0;
        this.viewportWidth = 0;
        this.viewportHeight = 0;
        this.gameField = [];
        this.mouseDown = false;
        this.running = false;
        this.generation = 1;
        this.initialized = false;
    }
    connectedCallback() {
        window.onresize = () => this.viewportUpdated();
        this.gameField = this.createGameField();
        this.setViewportValues();
        this.size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        this.attachShadow({ mode: "open" });
        this.createShadowDom();
        this.initialized = true;
    }
    attributeChangedCallback(name, oldValue, newValue) {
        if (this.initialized) {
            switch (name) {
                case "width":
                    if ((newValue !== oldValue) && (newValue !== this.columns)) {
                        this.columns = Math.max(10, newValue);
                        this.widthUpdated();
                    }
                    break;
                case "height":
                    if ((newValue !== oldValue) && (newValue !== this.rows)) {
                        this.rows = Math.max(10, newValue);
                        this.heightUpdated();
                    }
                    break;
                case "start":
                    this.start();
                    break;
                case "pause":
                    this.pause();
                    break;
                case "clear":
                    this.clear();
                    break;
                case "level":
                    this.loadLevel(newValue);
                    break;
                default:
                    break;
            }
        }
    }
    static get observedAttributes() {
        return ["width", "height", "start", "pause", "clear", "level"];
    }
    createGameField() {
        const arr = [];
        for (let row = 0; row < this.rows; row++) {
            arr[row] = [];
            for (let column = 0; column < this.columns; column++) {
                arr[row][column] = FieldState.Unset;
            }
        }
        return arr;
    }
    widthUpdated() {
        this.dispatchEvent(new CustomEvent("widthUpdatedEvent", { detail: this.columns }));
        this.sizeUpdated();
    }
    heightUpdated() {
        this.dispatchEvent(new CustomEvent("heightUpdatedEvent", { detail: this.rows }));
        this.sizeUpdated();
    }
    sizeUpdated() {
        this.gameField = this.createGameField();
        this.size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        this.createShadowDom();
    }
    setViewportValues() {
        this.viewportWidth = Math.min(document.documentElement.clientWidth, window.innerWidth);
        this.viewportHeight = Math.min(document.documentElement.clientHeight, window.innerHeight);
    }
    viewportUpdated() {
        this.setViewportValues();
        this.size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        const styleSheets = this.shadowRoot.styleSheets;
        let styleSheet = {};
        styleSheet = styleSheets[0];
        // .cell
        styleSheet["cssRules"][0].style.width = `${this.size}px`;
        styleSheet["cssRules"][0].style.height = `${this.size}px`;
        // .row
        styleSheet["cssRules"][1].style.width = `${this.size * this.columns}px`;
        styleSheet["cssRules"][1].style.height = `${this.size}px`;
        // .grid
        styleSheet["cssRules"][2].style.width = `${this.size * this.columns}px`;
        styleSheet["cssRules"][2].style.height = `${this.size * this.rows}px`;
    }
    createShadowDom() {
        this.shadowRoot.innerHTML = this.createShadowCss();
        const gridElem = this.createShadowGameField();
        this.shadowRoot.appendChild(gridElem);
        this.viewportUpdated();
    }
    createShadowCss() {
        return `<style>
    .cell {
      box-sizing: border-box;
      width: ${this.size}px;
      height: ${this.size}px;
      background-color: white;
      float: left;
      background-clip: content-box;
      padding: 1px;
    }

    .row {
      box-sizing: border-box;
      width: ${this.size * this.columns}px;
      height: ${this.size}px;
      clear: both;
      float: left;
    }

    .grid {
      box-sizing: border-box;
      width: ${this.size * this.columns}px;
      height: ${this.size * this.rows}px;
      margin: auto;
    }

    .unset {
      background-color: white;
    }

    .alive {
      background-color: darkblue;
    }

    .dead {
      background-color: lightgreen;
    }
    `;
    }
    createShadowGameField() {
        const gridElem = document.createElement("div");
        gridElem.className = "grid";
        for (let row = 0; row < this.rows; row++) {
            const rowElem = document.createElement("div");
            rowElem.className = "row";
            for (let column = 0; column < this.columns; column++) {
                const cellElem = document.createElement("div");
                cellElem.setAttribute("id", `${row},${column}`);
                switch (this.gameField[row][column]) {
                    case FieldState.Unset:
                        cellElem.className = "cell unset";
                        break;
                    case FieldState.Alive:
                        cellElem.className = "cell alive";
                        break;
                    case FieldState.Dead:
                        cellElem.className = "cell dead";
                        break;
                    default:
                        break;
                }
                cellElem.addEventListener("mouseover", () => this.cellHoveredHandler(row, column));
                cellElem.addEventListener("mousedown", () => this.cellDownHandler(row, column));
                cellElem.addEventListener("mouseup", () => this.cellUpHandler());
                cellElem.addEventListener("touchstart", () => this.cellTouchedHandler(row, column));
                rowElem.appendChild(cellElem);
            }
            gridElem.addEventListener("mousedown", () => this.fieldDownHandler());
            gridElem.addEventListener("mouseup", () => this.fieldUpHandler());
            gridElem.appendChild(rowElem);
        }
        return gridElem;
    }
    start() {
        if (!this.running) {
            this.running = true;
            this.execute();
        }
    }
    pause() {
        this.running = false;
    }
    clear() {
        this.running = false;
        this.gameField = this.createGameField();
        this.generation = 1;
        this.dispatchEvent(new CustomEvent("generationUpdatedEvent", { detail: this.generation }));
        this.updateField();
    }
    loadLevel(level) {
        const levelArray = level.split("\n");
        let rows = levelArray.length;
        let columns = 0;
        for (let row = 0; row < levelArray.length; row++) {
            levelArray[row] = levelArray[row].replace(/\s/g, ""); // remove spaces, write zero instead.
            columns = Math.max(columns, levelArray[row].length);
        }
        rows = Math.max(rows, 10);
        columns = Math.max(columns, 10);
        if (rows !== this.rows) {
            this.rows = rows;
            this.heightUpdated();
        }
        if (columns !== this.columns) {
            this.columns = columns;
            this.widthUpdated();
        }
        this.clear();
        for (let row = 0; row < levelArray.length; row++) {
            levelArray[row] += "0".repeat(columns - levelArray[row].length);
            for (let column = 0; column < columns; column++) {
                if (parseInt(levelArray[row][column], 10) === FieldState.Alive) {
                    this.gameField[row][column] = FieldState.Alive;
                }
                else {
                    this.gameField[row][column] = FieldState.Unset;
                }
            }
        }
        this.createShadowDom();
    }
    execute() {
        if (this.running) {
            const nextGenerationGameField = this.calculateNextGenerationGameField();
            this.gameField = nextGenerationGameField;
            this.updateField();
            this.generation++;
            this.dispatchEvent(new CustomEvent("generationUpdatedEvent", { detail: this.generation }));
            setTimeout(function () {
                this.execute();
            }.bind(this), 0);
        }
    }
    calculateNextGenerationGameField() {
        const nextGenerationGameField = this.createGameField();
        let countDifferentCells = 0;
        for (let row = 0; row < this.rows; row++) {
            for (let column = 0; column < this.columns; column++) {
                nextGenerationGameField[row][column] = this.calculateNextGenerationCell(row, column);
                if (nextGenerationGameField[row][column] !== this.gameField[row][column]) {
                    countDifferentCells++;
                }
            }
        }
        if (countDifferentCells === 0) {
            this.pause();
        }
        return nextGenerationGameField;
    }
    calculateNextGenerationCell(row, column) {
        const aliveNeighbours = this.countAliveNeighbours(row, column);
        if (this.gameField[row][column] === FieldState.Alive) {
            if (aliveNeighbours <= 1) {
                return FieldState.Dead;
            }
            else if (aliveNeighbours >= 4) {
                return FieldState.Dead;
            }
            else {
                return FieldState.Alive;
            }
        }
        else {
            if (aliveNeighbours === 3) {
                return FieldState.Alive;
            }
            else {
                return this.gameField[row][column];
            }
        }
    }
    countAliveNeighbours(row, column) {
        let aliveNeighbours = 0;
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                const rowToCheck = (row + i + this.rows) % this.rows;
                const columnToCheck = (column + j + this.columns) % this.columns;
                if (this.gameField[rowToCheck][columnToCheck] === FieldState.Alive) {
                    aliveNeighbours++;
                }
            }
        }
        if (this.gameField[row][column] === FieldState.Alive) {
            aliveNeighbours--;
        }
        return aliveNeighbours;
    }
    updateField() {
        for (let row = 0; row < this.rows; row++) {
            for (let column = 0; column < this.columns; column++) {
                const cell = this.shadowRoot.getElementById(`${row},${column}`);
                if (this.gameField[row][column] === FieldState.Unset) {
                    cell.setAttribute("class", "cell unset");
                }
                else if (this.gameField[row][column] === FieldState.Alive) {
                    cell.setAttribute("class", "cell alive");
                }
                else if (this.gameField[row][column] === FieldState.Dead) {
                    cell.setAttribute("class", "cell dead");
                }
            }
        }
    }
    cellTouchedHandler(row, column) {
        if (this.gameField[row][column] !== FieldState.Alive) {
            this.gameField[row][column] = FieldState.Alive;
            this.updateField();
        }
    }
    cellDownHandler(row, column) {
        this.mouseDown = true;
        if (this.gameField[row][column] !== FieldState.Alive) {
            this.gameField[row][column] = FieldState.Alive;
            this.updateField();
        }
    }
    fieldDownHandler() {
        this.mouseDown = true;
    }
    cellUpHandler() {
        this.mouseDown = false;
    }
    fieldUpHandler() {
        this.mouseDown = false;
    }
    cellHoveredHandler(row, column) {
        if (this.mouseDown && (this.gameField[row][column] !== FieldState.Alive)) {
            this.gameField[row][column] = FieldState.Alive;
            this.updateField();
        }
    }
}
window.customElements.define("cgol-pitch", GameField);

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDIiwiZmlsZSI6ImdhbWVGaWVsZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImVudW0gRmllbGRTdGF0ZSB7XG4gIFVuc2V0ID0gMCxcbiAgQWxpdmUsXG4gIERlYWQsXG59XG5cbmNsYXNzIEdhbWVGaWVsZCBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgcHJpdmF0ZSBjb2x1bW5zOiBudW1iZXI7XG4gIHByaXZhdGUgcm93czogbnVtYmVyO1xuXG4gIHByaXZhdGUgc2l6ZTogbnVtYmVyO1xuXG4gIHByaXZhdGUgdmlld3BvcnRXaWR0aDogbnVtYmVyO1xuICBwcml2YXRlIHZpZXdwb3J0SGVpZ2h0OiBudW1iZXI7XG5cbiAgcHJpdmF0ZSBnYW1lRmllbGQ6IG51bWJlcltdW107XG5cbiAgcHJpdmF0ZSBtb3VzZURvd246IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBydW5uaW5nOiBib29sZWFuO1xuICBwcml2YXRlIGdlbmVyYXRpb246IG51bWJlcjtcblxuICBwcml2YXRlIGluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5jb2x1bW5zID0gNjA7XG4gICAgdGhpcy5yb3dzID0gMjU7XG4gICAgdGhpcy5zaXplID0gMDtcbiAgICB0aGlzLnZpZXdwb3J0V2lkdGggPSAwO1xuICAgIHRoaXMudmlld3BvcnRIZWlnaHQgPSAwO1xuICAgIHRoaXMuZ2FtZUZpZWxkID0gW107XG4gICAgdGhpcy5tb3VzZURvd24gPSBmYWxzZTtcbiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICB0aGlzLmdlbmVyYXRpb24gPSAxO1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB3aW5kb3cub25yZXNpemUgPSAoKSA9PiB0aGlzLnZpZXdwb3J0VXBkYXRlZCgpO1xuXG4gICAgdGhpcy5nYW1lRmllbGQgPSB0aGlzLmNyZWF0ZUdhbWVGaWVsZCgpO1xuXG4gICAgdGhpcy5zZXRWaWV3cG9ydFZhbHVlcygpO1xuICAgIHRoaXMuc2l6ZSA9IE1hdGgubWluKHRoaXMudmlld3BvcnRXaWR0aCAvIHRoaXMuY29sdW1ucywgdGhpcy52aWV3cG9ydEhlaWdodCAvIHRoaXMucm93cyk7XG5cbiAgICB0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6IFwib3BlblwiIH0pO1xuICAgIHRoaXMuY3JlYXRlU2hhZG93RG9tKCk7XG5cbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sobmFtZTogc3RyaW5nLCBvbGRWYWx1ZTogYW55LCBuZXdWYWx1ZTogYW55KSB7XG4gICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICBjYXNlIFwid2lkdGhcIjpcbiAgICAgICAgICBpZiAoKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkgJiYgKG5ld1ZhbHVlICE9PSB0aGlzLmNvbHVtbnMpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbHVtbnMgPSBNYXRoLm1heCgxMCwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgdGhpcy53aWR0aFVwZGF0ZWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJoZWlnaHRcIjpcbiAgICAgICAgICBpZiAoKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkgJiYgKG5ld1ZhbHVlICE9PSB0aGlzLnJvd3MpKSB7XG4gICAgICAgICAgICB0aGlzLnJvd3MgPSBNYXRoLm1heCgxMCwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5oZWlnaHRVcGRhdGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3RhcnRcIjpcbiAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwYXVzZVwiOlxuICAgICAgICAgIHRoaXMucGF1c2UoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNsZWFyXCI6XG4gICAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibGV2ZWxcIjpcbiAgICAgICAgICB0aGlzLmxvYWRMZXZlbChuZXdWYWx1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgcmV0dXJuIFtcIndpZHRoXCIsIFwiaGVpZ2h0XCIsIFwic3RhcnRcIiwgXCJwYXVzZVwiLCBcImNsZWFyXCIsIFwibGV2ZWxcIl07XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUdhbWVGaWVsZCgpOiBudW1iZXJbXVtdIHtcbiAgICBjb25zdCBhcnI6IG51bWJlcltdW10gPSBbXTtcblxuICAgIGZvciAobGV0IHJvdzogbnVtYmVyID0gMDsgcm93IDwgdGhpcy5yb3dzOyByb3crKykge1xuICAgICAgYXJyW3Jvd10gPSBbXTtcbiAgICAgIGZvciAobGV0IGNvbHVtbjogbnVtYmVyID0gMDsgY29sdW1uIDwgdGhpcy5jb2x1bW5zOyBjb2x1bW4rKykge1xuICAgICAgICBhcnJbcm93XVtjb2x1bW5dID0gRmllbGRTdGF0ZS5VbnNldDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYXJyO1xuICB9XG5cbiAgcHJpdmF0ZSB3aWR0aFVwZGF0ZWQoKSB7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcIndpZHRoVXBkYXRlZEV2ZW50XCIsIHsgZGV0YWlsOiB0aGlzLmNvbHVtbnMgfSkpO1xuICAgIHRoaXMuc2l6ZVVwZGF0ZWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgaGVpZ2h0VXBkYXRlZCgpIHtcbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaGVpZ2h0VXBkYXRlZEV2ZW50XCIsIHsgZGV0YWlsOiB0aGlzLnJvd3MgfSkpO1xuICAgIHRoaXMuc2l6ZVVwZGF0ZWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2l6ZVVwZGF0ZWQoKSB7XG4gICAgdGhpcy5nYW1lRmllbGQgPSB0aGlzLmNyZWF0ZUdhbWVGaWVsZCgpO1xuICAgIHRoaXMuc2l6ZSA9IE1hdGgubWluKHRoaXMudmlld3BvcnRXaWR0aCAvIHRoaXMuY29sdW1ucywgdGhpcy52aWV3cG9ydEhlaWdodCAvIHRoaXMucm93cyk7XG4gICAgdGhpcy5jcmVhdGVTaGFkb3dEb20oKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Vmlld3BvcnRWYWx1ZXMoKSB7XG4gICAgdGhpcy52aWV3cG9ydFdpZHRoID0gTWF0aC5taW4oZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCB3aW5kb3cuaW5uZXJXaWR0aCk7XG4gICAgdGhpcy52aWV3cG9ydEhlaWdodCA9IE1hdGgubWluKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gIH1cblxuICBwcml2YXRlIHZpZXdwb3J0VXBkYXRlZCgpIHtcbiAgICB0aGlzLnNldFZpZXdwb3J0VmFsdWVzKCk7XG5cbiAgICB0aGlzLnNpemUgPSBNYXRoLm1pbih0aGlzLnZpZXdwb3J0V2lkdGggLyB0aGlzLmNvbHVtbnMsIHRoaXMudmlld3BvcnRIZWlnaHQgLyB0aGlzLnJvd3MpO1xuXG4gICAgY29uc3Qgc3R5bGVTaGVldHMgPSB0aGlzLnNoYWRvd1Jvb3Quc3R5bGVTaGVldHM7XG4gICAgbGV0IHN0eWxlU2hlZXQ6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIHN0eWxlU2hlZXQgPSBzdHlsZVNoZWV0c1swXTtcblxuICAgIC8vIC5jZWxsXG4gICAgc3R5bGVTaGVldFtcImNzc1J1bGVzXCJdWzBdLnN0eWxlLndpZHRoID0gYCR7dGhpcy5zaXplfXB4YDtcbiAgICBzdHlsZVNoZWV0W1wiY3NzUnVsZXNcIl1bMF0uc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5zaXplfXB4YDtcblxuICAgIC8vIC5yb3dcbiAgICBzdHlsZVNoZWV0W1wiY3NzUnVsZXNcIl1bMV0uc3R5bGUud2lkdGggPSBgJHt0aGlzLnNpemUgKiB0aGlzLmNvbHVtbnN9cHhgO1xuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVsxXS5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLnNpemV9cHhgO1xuXG4gICAgLy8gLmdyaWRcbiAgICBzdHlsZVNoZWV0W1wiY3NzUnVsZXNcIl1bMl0uc3R5bGUud2lkdGggPSBgJHt0aGlzLnNpemUgKiB0aGlzLmNvbHVtbnN9cHhgO1xuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVsyXS5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLnNpemUgKiB0aGlzLnJvd3N9cHhgO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTaGFkb3dEb20oKSB7XG4gICAgdGhpcy5zaGFkb3dSb290LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlU2hhZG93Q3NzKCk7XG4gICAgY29uc3QgZ3JpZEVsZW0gPSB0aGlzLmNyZWF0ZVNoYWRvd0dhbWVGaWVsZCgpO1xuICAgIHRoaXMuc2hhZG93Um9vdC5hcHBlbmRDaGlsZChncmlkRWxlbSk7XG4gICAgdGhpcy52aWV3cG9ydFVwZGF0ZWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2hhZG93Q3NzKCkge1xuICAgIHJldHVybiBgPHN0eWxlPlxuICAgIC5jZWxsIHtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICB3aWR0aDogJHt0aGlzLnNpemV9cHg7XG4gICAgICBoZWlnaHQ6ICR7dGhpcy5zaXplfXB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgICBmbG9hdDogbGVmdDtcbiAgICAgIGJhY2tncm91bmQtY2xpcDogY29udGVudC1ib3g7XG4gICAgICBwYWRkaW5nOiAxcHg7XG4gICAgfVxuXG4gICAgLnJvdyB7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgd2lkdGg6ICR7dGhpcy5zaXplICogdGhpcy5jb2x1bW5zfXB4O1xuICAgICAgaGVpZ2h0OiAke3RoaXMuc2l6ZX1weDtcbiAgICAgIGNsZWFyOiBib3RoO1xuICAgICAgZmxvYXQ6IGxlZnQ7XG4gICAgfVxuXG4gICAgLmdyaWQge1xuICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICAgIHdpZHRoOiAke3RoaXMuc2l6ZSAqIHRoaXMuY29sdW1uc31weDtcbiAgICAgIGhlaWdodDogJHt0aGlzLnNpemUgKiB0aGlzLnJvd3N9cHg7XG4gICAgICBtYXJnaW46IGF1dG87XG4gICAgfVxuXG4gICAgLnVuc2V0IHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICAgIH1cblxuICAgIC5hbGl2ZSB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBkYXJrYmx1ZTtcbiAgICB9XG5cbiAgICAuZGVhZCB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodGdyZWVuO1xuICAgIH1cbiAgICBgO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTaGFkb3dHYW1lRmllbGQoKSB7XG4gICAgY29uc3QgZ3JpZEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGdyaWRFbGVtLmNsYXNzTmFtZSA9IFwiZ3JpZFwiO1xuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IHRoaXMucm93czsgcm93KyspIHtcbiAgICAgIGNvbnN0IHJvd0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcm93RWxlbS5jbGFzc05hbWUgPSBcInJvd1wiO1xuICAgICAgZm9yIChsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgdGhpcy5jb2x1bW5zOyBjb2x1bW4rKykge1xuICAgICAgICBjb25zdCBjZWxsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGxFbGVtLnNldEF0dHJpYnV0ZShcImlkXCIsIGAke3Jvd30sJHtjb2x1bW59YCk7XG5cbiAgICAgICAgc3dpdGNoICh0aGlzLmdhbWVGaWVsZFtyb3ddW2NvbHVtbl0pIHtcbiAgICAgICAgICBjYXNlIEZpZWxkU3RhdGUuVW5zZXQ6XG4gICAgICAgICAgICBjZWxsRWxlbS5jbGFzc05hbWUgPSBcImNlbGwgdW5zZXRcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmllbGRTdGF0ZS5BbGl2ZTpcbiAgICAgICAgICAgIGNlbGxFbGVtLmNsYXNzTmFtZSA9IFwiY2VsbCBhbGl2ZVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWVsZFN0YXRlLkRlYWQ6XG4gICAgICAgICAgICBjZWxsRWxlbS5jbGFzc05hbWUgPSBcImNlbGwgZGVhZFwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgY2VsbEVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoKSA9PiB0aGlzLmNlbGxIb3ZlcmVkSGFuZGxlcihyb3csIGNvbHVtbikpO1xuICAgICAgICBjZWxsRWxlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICgpID0+IHRoaXMuY2VsbERvd25IYW5kbGVyKHJvdywgY29sdW1uKSk7XG4gICAgICAgIGNlbGxFbGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsICgpID0+IHRoaXMuY2VsbFVwSGFuZGxlcigpKTtcbiAgICAgICAgY2VsbEVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKCkgPT4gdGhpcy5jZWxsVG91Y2hlZEhhbmRsZXIocm93LCBjb2x1bW4pKTtcbiAgICAgICAgcm93RWxlbS5hcHBlbmRDaGlsZChjZWxsRWxlbSk7XG4gICAgICB9XG4gICAgICBncmlkRWxlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICgpID0+IHRoaXMuZmllbGREb3duSGFuZGxlcigpKTtcbiAgICAgIGdyaWRFbGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsICgpID0+IHRoaXMuZmllbGRVcEhhbmRsZXIoKSk7XG4gICAgICBncmlkRWxlbS5hcHBlbmRDaGlsZChyb3dFbGVtKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3JpZEVsZW07XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0KCkge1xuICAgIGlmICghdGhpcy5ydW5uaW5nKSB7XG4gICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlO1xuICAgICAgdGhpcy5leGVjdXRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBwYXVzZSgpIHtcbiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXIoKSB7XG4gICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgdGhpcy5nYW1lRmllbGQgPSB0aGlzLmNyZWF0ZUdhbWVGaWVsZCgpO1xuICAgIHRoaXMuZ2VuZXJhdGlvbiA9IDE7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImdlbmVyYXRpb25VcGRhdGVkRXZlbnRcIiwgeyBkZXRhaWw6IHRoaXMuZ2VuZXJhdGlvbiB9KSk7XG4gICAgdGhpcy51cGRhdGVGaWVsZCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkTGV2ZWwobGV2ZWw6IHN0cmluZykge1xuICAgIGNvbnN0IGxldmVsQXJyYXkgPSBsZXZlbC5zcGxpdChcIlxcblwiKTtcblxuICAgIGxldCByb3dzID0gbGV2ZWxBcnJheS5sZW5ndGg7XG4gICAgbGV0IGNvbHVtbnMgPSAwO1xuXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgbGV2ZWxBcnJheS5sZW5ndGg7IHJvdysrKSB7XG4gICAgICBsZXZlbEFycmF5W3Jvd10gPSBsZXZlbEFycmF5W3Jvd10ucmVwbGFjZSgvXFxzL2csIFwiXCIpOyAvLyByZW1vdmUgc3BhY2VzLCB3cml0ZSB6ZXJvIGluc3RlYWQuXG4gICAgICBjb2x1bW5zID0gTWF0aC5tYXgoY29sdW1ucywgbGV2ZWxBcnJheVtyb3ddLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcm93cyA9IE1hdGgubWF4KHJvd3MsIDEwKTtcbiAgICBjb2x1bW5zID0gTWF0aC5tYXgoY29sdW1ucywgMTApO1xuXG4gICAgaWYgKHJvd3MgIT09IHRoaXMucm93cykge1xuICAgICAgdGhpcy5yb3dzID0gcm93cztcbiAgICAgIHRoaXMuaGVpZ2h0VXBkYXRlZCgpO1xuICAgIH1cblxuICAgIGlmIChjb2x1bW5zICE9PSB0aGlzLmNvbHVtbnMpIHtcbiAgICAgIHRoaXMuY29sdW1ucyA9IGNvbHVtbnM7XG4gICAgICB0aGlzLndpZHRoVXBkYXRlZCgpO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXIoKTtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGxldmVsQXJyYXkubGVuZ3RoOyByb3crKykge1xuICAgICAgbGV2ZWxBcnJheVtyb3ddICs9IFwiMFwiLnJlcGVhdChjb2x1bW5zIC0gbGV2ZWxBcnJheVtyb3ddLmxlbmd0aCk7XG4gICAgICBmb3IgKGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCBjb2x1bW5zOyBjb2x1bW4rKykge1xuICAgICAgICBpZiAocGFyc2VJbnQobGV2ZWxBcnJheVtyb3ddW2NvbHVtbl0sIDEwKSA9PT0gRmllbGRTdGF0ZS5BbGl2ZSkge1xuICAgICAgICAgIHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXSA9IEZpZWxkU3RhdGUuQWxpdmU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dID0gRmllbGRTdGF0ZS5VbnNldDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY3JlYXRlU2hhZG93RG9tKCk7XG4gIH1cblxuICBwcml2YXRlIGV4ZWN1dGUoKSB7XG4gICAgaWYgKHRoaXMucnVubmluZykge1xuICAgICAgY29uc3QgbmV4dEdlbmVyYXRpb25HYW1lRmllbGQgPSB0aGlzLmNhbGN1bGF0ZU5leHRHZW5lcmF0aW9uR2FtZUZpZWxkKCk7XG5cbiAgICAgIHRoaXMuZ2FtZUZpZWxkID0gbmV4dEdlbmVyYXRpb25HYW1lRmllbGQ7XG4gICAgICB0aGlzLnVwZGF0ZUZpZWxkKCk7XG5cbiAgICAgIHRoaXMuZ2VuZXJhdGlvbisrO1xuICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImdlbmVyYXRpb25VcGRhdGVkRXZlbnRcIiwgeyBkZXRhaWw6IHRoaXMuZ2VuZXJhdGlvbiB9KSk7XG5cbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZXhlY3V0ZSgpO1xuICAgICAgfS5iaW5kKHRoaXMpLCAwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZU5leHRHZW5lcmF0aW9uR2FtZUZpZWxkKCkge1xuICAgIGNvbnN0IG5leHRHZW5lcmF0aW9uR2FtZUZpZWxkID0gdGhpcy5jcmVhdGVHYW1lRmllbGQoKTtcbiAgICBsZXQgY291bnREaWZmZXJlbnRDZWxscyA9IDA7XG5cbiAgICBmb3IgKGxldCByb3c6IG51bWJlciA9IDA7IHJvdyA8IHRoaXMucm93czsgcm93KyspIHtcbiAgICAgIGZvciAobGV0IGNvbHVtbjogbnVtYmVyID0gMDsgY29sdW1uIDwgdGhpcy5jb2x1bW5zOyBjb2x1bW4rKykge1xuICAgICAgICBuZXh0R2VuZXJhdGlvbkdhbWVGaWVsZFtyb3ddW2NvbHVtbl0gPSB0aGlzLmNhbGN1bGF0ZU5leHRHZW5lcmF0aW9uQ2VsbChyb3csIGNvbHVtbik7XG4gICAgICAgIGlmIChuZXh0R2VuZXJhdGlvbkdhbWVGaWVsZFtyb3ddW2NvbHVtbl0gIT09IHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXSkge1xuICAgICAgICAgIGNvdW50RGlmZmVyZW50Q2VsbHMrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb3VudERpZmZlcmVudENlbGxzID09PSAwKSB7XG4gICAgICB0aGlzLnBhdXNlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHRHZW5lcmF0aW9uR2FtZUZpZWxkO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVOZXh0R2VuZXJhdGlvbkNlbGwocm93OiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogRmllbGRTdGF0ZSB7XG4gICAgY29uc3QgYWxpdmVOZWlnaGJvdXJzID0gdGhpcy5jb3VudEFsaXZlTmVpZ2hib3Vycyhyb3csIGNvbHVtbik7XG5cbiAgICBpZiAodGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dID09PSBGaWVsZFN0YXRlLkFsaXZlKSB7XG4gICAgICBpZiAoYWxpdmVOZWlnaGJvdXJzIDw9IDEpIHtcbiAgICAgICAgcmV0dXJuIEZpZWxkU3RhdGUuRGVhZDtcbiAgICAgIH0gZWxzZSBpZiAoYWxpdmVOZWlnaGJvdXJzID49IDQpIHtcbiAgICAgICAgcmV0dXJuIEZpZWxkU3RhdGUuRGVhZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBGaWVsZFN0YXRlLkFsaXZlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoYWxpdmVOZWlnaGJvdXJzID09PSAzKSB7XG4gICAgICAgIHJldHVybiBGaWVsZFN0YXRlLkFsaXZlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50QWxpdmVOZWlnaGJvdXJzKHJvdzogbnVtYmVyLCBjb2x1bW46IG51bWJlcik6IG51bWJlciB7XG4gICAgbGV0IGFsaXZlTmVpZ2hib3VycyA9IDA7XG5cbiAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAtMTsgaSA8PSAxOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGo6IG51bWJlciA9IC0xOyBqIDw9IDE7IGorKykge1xuICAgICAgICBjb25zdCByb3dUb0NoZWNrID0gKHJvdyArIGkgKyB0aGlzLnJvd3MpICUgdGhpcy5yb3dzO1xuICAgICAgICBjb25zdCBjb2x1bW5Ub0NoZWNrID0gKGNvbHVtbiArIGogKyB0aGlzLmNvbHVtbnMpICUgdGhpcy5jb2x1bW5zO1xuICAgICAgICBpZiAodGhpcy5nYW1lRmllbGRbcm93VG9DaGVja11bY29sdW1uVG9DaGVja10gPT09IEZpZWxkU3RhdGUuQWxpdmUpIHtcbiAgICAgICAgICBhbGl2ZU5laWdoYm91cnMrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmdhbWVGaWVsZFtyb3ddW2NvbHVtbl0gPT09IEZpZWxkU3RhdGUuQWxpdmUpIHtcbiAgICAgIGFsaXZlTmVpZ2hib3Vycy0tO1xuICAgIH1cblxuICAgIHJldHVybiBhbGl2ZU5laWdoYm91cnM7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUZpZWxkKCkge1xuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IHRoaXMucm93czsgcm93KyspIHtcbiAgICAgIGZvciAobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IHRoaXMuY29sdW1uczsgY29sdW1uKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChgJHtyb3d9LCR7Y29sdW1ufWApO1xuICAgICAgICBpZiAodGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dID09PSBGaWVsZFN0YXRlLlVuc2V0KSB7XG4gICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImNlbGwgdW5zZXRcIik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dID09PSBGaWVsZFN0YXRlLkFsaXZlKSB7XG4gICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImNlbGwgYWxpdmVcIik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dID09PSBGaWVsZFN0YXRlLkRlYWQpIHtcbiAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiY2VsbCBkZWFkXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjZWxsVG91Y2hlZEhhbmRsZXIocm93OiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogYW55IHtcbiAgICBpZiAodGhpcy5nYW1lRmllbGRbcm93XVtjb2x1bW5dICE9PSBGaWVsZFN0YXRlLkFsaXZlKSB7XG4gICAgICB0aGlzLmdhbWVGaWVsZFtyb3ddW2NvbHVtbl0gPSBGaWVsZFN0YXRlLkFsaXZlO1xuICAgICAgdGhpcy51cGRhdGVGaWVsZCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2VsbERvd25IYW5kbGVyKHJvdzogbnVtYmVyLCBjb2x1bW46IG51bWJlcik6IGFueSB7XG4gICAgdGhpcy5tb3VzZURvd24gPSB0cnVlO1xuICAgIGlmICh0aGlzLmdhbWVGaWVsZFtyb3ddW2NvbHVtbl0gIT09IEZpZWxkU3RhdGUuQWxpdmUpIHtcbiAgICAgIHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXSA9IEZpZWxkU3RhdGUuQWxpdmU7XG4gICAgICB0aGlzLnVwZGF0ZUZpZWxkKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaWVsZERvd25IYW5kbGVyKCk6IGFueSB7XG4gICAgdGhpcy5tb3VzZURvd24gPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBjZWxsVXBIYW5kbGVyKCk6IGFueSB7XG4gICAgdGhpcy5tb3VzZURvd24gPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgZmllbGRVcEhhbmRsZXIoKTogYW55IHtcbiAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBjZWxsSG92ZXJlZEhhbmRsZXIocm93OiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogYW55IHtcbiAgICBpZiAodGhpcy5tb3VzZURvd24gJiYgKHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXSAhPT0gRmllbGRTdGF0ZS5BbGl2ZSkpIHtcbiAgICAgIHRoaXMuZ2FtZUZpZWxkW3Jvd11bY29sdW1uXSA9IEZpZWxkU3RhdGUuQWxpdmU7XG4gICAgICB0aGlzLnVwZGF0ZUZpZWxkKCk7XG4gICAgfVxuICB9XG59XG5cbndpbmRvdy5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJjZ29sLXBpdGNoXCIsIEdhbWVGaWVsZCk7XG4iXX0=
