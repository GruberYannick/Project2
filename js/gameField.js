var FieldState;
(function (FieldState) {
    FieldState[FieldState["Unset"] = 0] = "Unset";
    FieldState[FieldState["Alive"] = 1] = "Alive";
    FieldState[FieldState["Dead"] = 2] = "Dead";
})(FieldState || (FieldState = {}));
class GameField extends HTMLElement {
    constructor() {
        super();
    }
    connectedCallback() {
        window.onresize = () => this.viewportUpdated();
        document.querySelector("#setSize").addEventListener("click", (e) => this.buttonClickedHandler("setSize"));
        this.columns = parseInt(this.getAttribute("width"), 10);
        this.rows = parseInt(this.getAttribute("height"), 10);
        this.columns = Math.max(10, this.columns);
        this.rows = Math.max(10, this.rows);
        this.gameField = this.createGameField();
        this.setViewportValues();
        const size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        this.attachShadow({ mode: "open" });
        this.updateShadowDom(size);
        this.viewportUpdated();
    }
    disconnectedCallback() {
        return;
    }
    adoptedCallback() {
        return;
    }
    attributeChangedCallback(name, oldValue, newValue) {
        return;
    }
    static get observedAttributes() {
        return [];
    }
    createGameField() {
        const arr = [];
        for (let i = 0; i < this.rows; i++) {
            arr[i] = [];
            for (let j = 0; j < this.columns; j++) {
                arr[i][j] = FieldState.Unset;
            }
        }
        return arr;
    }
    updateShadowDom(size) {
        this.shadowRoot.innerHTML = this.createShadowCss(size);
        const gridElem = this.createShadowGameField();
        this.shadowRoot.appendChild(gridElem);
    }
    setViewportValues() {
        this.viewportWidth = Math.min(document.documentElement.clientWidth, window.innerWidth);
        this.viewportHeight = Math.min(document.documentElement.clientHeight, window.innerHeight);
    }
    createShadowGameField() {
        const gridElem = document.createElement("div");
        gridElem.className += "grid";
        for (let row = 0; row < this.rows; row++) {
            const rowElem = document.createElement("div");
            rowElem.className += "row";
            for (let column = 0; column < this.columns; column++) {
                const boxElem = document.createElement("div");
                boxElem.setAttribute("row", row.toString());
                boxElem.setAttribute("column", column.toString());
                boxElem.className += "box";
                boxElem.addEventListener("click", (e) => this.fieldClickedHandler(row, column));
                rowElem.appendChild(boxElem);
            }
            gridElem.appendChild(rowElem);
        }
        return gridElem;
    }
    fieldClickedHandler(row, column) {
        return;
    }
    createShadowCss(size) {
        return `<style>
    .box {
      box-sizing: border-box;
      width: ${size}px;
      height: ${size}px;
      background-color: white;
      float: left;
      background-clip: content-box;
      padding: 1px;
    }

    .row {
      box-sizing: border-box;
      width: ${size * this.columns}px;
      height: ${size}px;
      clear: both;
      float: left;
    }

    .grid {
      box-sizing: border-box;
      width: ${size * this.columns}px;
      height: ${size * this.rows}px;
    }`;
    }
    buttonClickedHandler(id) {
        switch (id) {
            case "setSize":
                this.sizeUpdated();
                break;
            default:
                break;
        }
    }
    sizeUpdated() {
        this.columns = parseInt(document.getElementById("width").value, 10);
        this.rows = parseInt(document.getElementById("height").value, 10);
        this.columns = Math.max(10, this.columns);
        this.rows = Math.max(10, this.rows);
        document.getElementById("width").value = this.columns.toString();
        document.getElementById("height").value = this.rows.toString();
        this.gameField = this.createGameField();
        const size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        this.updateShadowDom(size);
        this.viewportUpdated();
    }
    viewportUpdated() {
        this.setViewportValues();
        const size = Math.min(this.viewportWidth / this.columns, this.viewportHeight / this.rows);
        const styleSheets = this.shadowRoot.styleSheets;
        let styleSheet = {};
        styleSheet = styleSheets[0];
        // .box
        styleSheet["cssRules"][0].style.width = `${size}px`;
        styleSheet["cssRules"][0].style.height = `${size}px`;
        // .row
        styleSheet["cssRules"][1].style.width = `${size * this.columns}px`;
        styleSheet["cssRules"][1].style.height = `${size}px`;
        // .grid
        styleSheet["cssRules"][2].style.width = `${size * this.columns}px`;
        styleSheet["cssRules"][2].style.height = `${size * this.rows}px`;
    }
}
window.customElements.define("cgol-pitch", GameField);

//# sourceMappingURL=data:application/json;charset=utf8;base64,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VUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDO1FBRXJELE9BQU87UUFDUCxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUM7UUFDbkUsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQztRQUVyRCxRQUFRO1FBQ1IsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDO1FBQ25FLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztJQUNuRSxDQUFDO0NBQ0Y7QUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUMiLCJmaWxlIjoiZ2FtZUZpZWxkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZW51bSBGaWVsZFN0YXRlIHtcbiAgVW5zZXQgPSAwLFxuICBBbGl2ZSxcbiAgRGVhZCxcbn1cblxuY2xhc3MgR2FtZUZpZWxkIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICBwcml2YXRlIGNvbHVtbnM6IG51bWJlcjtcbiAgcHJpdmF0ZSByb3dzOiBudW1iZXI7XG5cbiAgcHJpdmF0ZSB2aWV3cG9ydFdpZHRoOiBudW1iZXI7XG4gIHByaXZhdGUgdmlld3BvcnRIZWlnaHQ6IG51bWJlcjtcblxuICBwcml2YXRlIGdhbWVGaWVsZDogbnVtYmVyW11bXTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHdpbmRvdy5vbnJlc2l6ZSA9ICgpID0+IHRoaXMudmlld3BvcnRVcGRhdGVkKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzZXRTaXplXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4gdGhpcy5idXR0b25DbGlja2VkSGFuZGxlcihcInNldFNpemVcIikpO1xuXG4gICAgdGhpcy5jb2x1bW5zID0gcGFyc2VJbnQodGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKSwgMTApO1xuICAgIHRoaXMucm93cyA9IHBhcnNlSW50KHRoaXMuZ2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIpLCAxMCk7XG5cbiAgICB0aGlzLmNvbHVtbnMgPSBNYXRoLm1heCgxMCwgdGhpcy5jb2x1bW5zKTtcbiAgICB0aGlzLnJvd3MgPSBNYXRoLm1heCgxMCwgdGhpcy5yb3dzKTtcblxuICAgIHRoaXMuZ2FtZUZpZWxkID0gdGhpcy5jcmVhdGVHYW1lRmllbGQoKTtcblxuICAgIHRoaXMuc2V0Vmlld3BvcnRWYWx1ZXMoKTtcbiAgICBjb25zdCBzaXplID0gTWF0aC5taW4odGhpcy52aWV3cG9ydFdpZHRoIC8gdGhpcy5jb2x1bW5zLCB0aGlzLnZpZXdwb3J0SGVpZ2h0IC8gdGhpcy5yb3dzKTtcblxuICAgIHRoaXMuYXR0YWNoU2hhZG93KHsgbW9kZTogXCJvcGVuXCIgfSk7XG4gICAgdGhpcy51cGRhdGVTaGFkb3dEb20oc2l6ZSk7XG5cbiAgICB0aGlzLnZpZXdwb3J0VXBkYXRlZCgpO1xuICB9XG5cbiAgcHVibGljIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHB1YmxpYyBhZG9wdGVkQ2FsbGJhY2soKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcHVibGljIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhuYW1lOiBhbnksIG9sZFZhbHVlOiBhbnksIG5ld1ZhbHVlOiBhbnkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpOiBhbnkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlR2FtZUZpZWxkKCk6IG51bWJlcltdW10ge1xuICAgIGNvbnN0IGFycjogbnVtYmVyW11bXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMucm93czsgaSsrKSB7XG4gICAgICBhcnJbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGo6IG51bWJlciA9IDA7IGogPCB0aGlzLmNvbHVtbnM7IGorKykge1xuICAgICAgICBhcnJbaV1bal0gPSBGaWVsZFN0YXRlLlVuc2V0O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhcnI7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNoYWRvd0RvbShzaXplOiBudW1iZXIpIHtcbiAgICB0aGlzLnNoYWRvd1Jvb3QuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVTaGFkb3dDc3Moc2l6ZSk7XG4gICAgY29uc3QgZ3JpZEVsZW0gPSB0aGlzLmNyZWF0ZVNoYWRvd0dhbWVGaWVsZCgpO1xuICAgIHRoaXMuc2hhZG93Um9vdC5hcHBlbmRDaGlsZChncmlkRWxlbSk7XG4gIH1cblxuICBwcml2YXRlIHNldFZpZXdwb3J0VmFsdWVzKCkge1xuICAgIHRoaXMudmlld3BvcnRXaWR0aCA9IE1hdGgubWluKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgd2luZG93LmlubmVyV2lkdGgpO1xuICAgIHRoaXMudmlld3BvcnRIZWlnaHQgPSBNYXRoLm1pbihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTaGFkb3dHYW1lRmllbGQoKSB7XG4gICAgY29uc3QgZ3JpZEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGdyaWRFbGVtLmNsYXNzTmFtZSArPSBcImdyaWRcIjtcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCB0aGlzLnJvd3M7IHJvdysrKSB7XG4gICAgICBjb25zdCByb3dFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0VsZW0uY2xhc3NOYW1lICs9IFwicm93XCI7XG4gICAgICBmb3IgKGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCB0aGlzLmNvbHVtbnM7IGNvbHVtbisrKSB7XG4gICAgICAgIGNvbnN0IGJveEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBib3hFbGVtLnNldEF0dHJpYnV0ZShcInJvd1wiLCByb3cudG9TdHJpbmcoKSk7XG4gICAgICAgIGJveEVsZW0uc2V0QXR0cmlidXRlKFwiY29sdW1uXCIsIGNvbHVtbi50b1N0cmluZygpKTtcbiAgICAgICAgYm94RWxlbS5jbGFzc05hbWUgKz0gXCJib3hcIjtcbiAgICAgICAgYm94RWxlbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHRoaXMuZmllbGRDbGlja2VkSGFuZGxlcihyb3csIGNvbHVtbikpO1xuICAgICAgICByb3dFbGVtLmFwcGVuZENoaWxkKGJveEVsZW0pO1xuICAgICAgfVxuICAgICAgZ3JpZEVsZW0uYXBwZW5kQ2hpbGQocm93RWxlbSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdyaWRFbGVtO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWVsZENsaWNrZWRIYW5kbGVyKHJvdzogbnVtYmVyLCBjb2x1bW46IG51bWJlcik6IGFueSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTaGFkb3dDc3Moc2l6ZTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIGA8c3R5bGU+XG4gICAgLmJveCB7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgd2lkdGg6ICR7c2l6ZX1weDtcbiAgICAgIGhlaWdodDogJHtzaXplfXB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgICBmbG9hdDogbGVmdDtcbiAgICAgIGJhY2tncm91bmQtY2xpcDogY29udGVudC1ib3g7XG4gICAgICBwYWRkaW5nOiAxcHg7XG4gICAgfVxuXG4gICAgLnJvdyB7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgd2lkdGg6ICR7c2l6ZSAqIHRoaXMuY29sdW1uc31weDtcbiAgICAgIGhlaWdodDogJHtzaXplfXB4O1xuICAgICAgY2xlYXI6IGJvdGg7XG4gICAgICBmbG9hdDogbGVmdDtcbiAgICB9XG5cbiAgICAuZ3JpZCB7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgd2lkdGg6ICR7c2l6ZSAqIHRoaXMuY29sdW1uc31weDtcbiAgICAgIGhlaWdodDogJHtzaXplICogdGhpcy5yb3dzfXB4O1xuICAgIH1gO1xuICB9XG5cbiAgcHJpdmF0ZSBidXR0b25DbGlja2VkSGFuZGxlcihpZDogc3RyaW5nKSB7XG4gICAgc3dpdGNoIChpZCkge1xuICAgICAgY2FzZSBcInNldFNpemVcIjpcbiAgICAgICAgdGhpcy5zaXplVXBkYXRlZCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2l6ZVVwZGF0ZWQoKSB7XG4gICAgdGhpcy5jb2x1bW5zID0gcGFyc2VJbnQoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2lkdGhcIikgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUsIDEwKTtcbiAgICB0aGlzLnJvd3MgPSBwYXJzZUludCgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJoZWlnaHRcIikgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUsIDEwKTtcblxuICAgIHRoaXMuY29sdW1ucyA9IE1hdGgubWF4KDEwLCB0aGlzLmNvbHVtbnMpO1xuICAgIHRoaXMucm93cyA9IE1hdGgubWF4KDEwLCB0aGlzLnJvd3MpO1xuXG4gICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2lkdGhcIikgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUgPSB0aGlzLmNvbHVtbnMudG9TdHJpbmcoKTtcbiAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJoZWlnaHRcIikgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUgPSB0aGlzLnJvd3MudG9TdHJpbmcoKTtcblxuICAgIHRoaXMuZ2FtZUZpZWxkID0gdGhpcy5jcmVhdGVHYW1lRmllbGQoKTtcblxuICAgIGNvbnN0IHNpemUgPSBNYXRoLm1pbih0aGlzLnZpZXdwb3J0V2lkdGggLyB0aGlzLmNvbHVtbnMsIHRoaXMudmlld3BvcnRIZWlnaHQgLyB0aGlzLnJvd3MpO1xuXG4gICAgdGhpcy51cGRhdGVTaGFkb3dEb20oc2l6ZSk7XG5cbiAgICB0aGlzLnZpZXdwb3J0VXBkYXRlZCgpO1xuICB9XG5cbiAgcHJpdmF0ZSB2aWV3cG9ydFVwZGF0ZWQoKSB7XG4gICAgdGhpcy5zZXRWaWV3cG9ydFZhbHVlcygpO1xuXG4gICAgY29uc3Qgc2l6ZSA9IE1hdGgubWluKHRoaXMudmlld3BvcnRXaWR0aCAvIHRoaXMuY29sdW1ucywgdGhpcy52aWV3cG9ydEhlaWdodCAvIHRoaXMucm93cyk7XG5cbiAgICBjb25zdCBzdHlsZVNoZWV0cyA9IHRoaXMuc2hhZG93Um9vdC5zdHlsZVNoZWV0cztcbiAgICBsZXQgc3R5bGVTaGVldDogeyBbaW5kZXg6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgc3R5bGVTaGVldCA9IHN0eWxlU2hlZXRzWzBdO1xuXG4gICAgLy8gLmJveFxuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVswXS5zdHlsZS53aWR0aCA9IGAke3NpemV9cHhgO1xuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVswXS5zdHlsZS5oZWlnaHQgPSBgJHtzaXplfXB4YDtcblxuICAgIC8vIC5yb3dcbiAgICBzdHlsZVNoZWV0W1wiY3NzUnVsZXNcIl1bMV0uc3R5bGUud2lkdGggPSBgJHtzaXplICogdGhpcy5jb2x1bW5zfXB4YDtcbiAgICBzdHlsZVNoZWV0W1wiY3NzUnVsZXNcIl1bMV0uc3R5bGUuaGVpZ2h0ID0gYCR7c2l6ZX1weGA7XG5cbiAgICAvLyAuZ3JpZFxuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVsyXS5zdHlsZS53aWR0aCA9IGAke3NpemUgKiB0aGlzLmNvbHVtbnN9cHhgO1xuICAgIHN0eWxlU2hlZXRbXCJjc3NSdWxlc1wiXVsyXS5zdHlsZS5oZWlnaHQgPSBgJHtzaXplICogdGhpcy5yb3dzfXB4YDtcbiAgfVxufVxuXG53aW5kb3cuY3VzdG9tRWxlbWVudHMuZGVmaW5lKFwiY2dvbC1waXRjaFwiLCBHYW1lRmllbGQpO1xuIl19
